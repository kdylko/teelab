<% javascript_include_tag "https://widget.cloudpayments.ru/bundles/cloudpayments" %>
<div class="row">
    <div class="form-container  small-12  medium-7 large-7 medium-offset-1 large-offset-1 columns ">
        <br>
        <h3>Информация о заказе</h3>
        <br>
        <table class="responsive text-center">
          <thead>
            <tr>
                <th class="text-center">Кол-во</th>
                <th class="text-center">Фото</th>
                <th class="text-center">Модель</th>
                <th class="text-center">Фасон</th>
                <th class="text-center">Параметры</th>
                <th class="text-center">Цена</th>
                <th class="text-center">Убрать</th>
            </tr>
          </thead>
          <tbody>
            <%= render(@cart.line_items) %>
            <tr class="">
                 <td >Доставка</td>
                 <td ></td>
                 <td ></td>
                 <td ></td>
                 <td ></td>
                 <td id="deliv"></td>
                 <td ></td>
            </tr>
            <tr class="">
                 <td colspan="1">Всего</td>
              
                 <td colspan="4"></td>
                 <td colspan="1" id="total"></td>
                 <td colspan="1"></td>
            </tr>
          </tbody>
        </table>
    </div>
    <div class="form-container  small-12  medium-4 large-4 columns end">
    <br>
    <h3>Оформление заказа</h3>
    <br>
    <%= render 'form' %>
    </div>
</div>


<%= javascript_tag do %>


  $('select').change(refresh);

  
      function priceChanger() {
       var a = document.getElementById('order_delivery_price').value;
       a = Number(a);
       return a;
      }

      function total() {
        return priceChanger() + <%= @cart.total_price %>;
      }

      function refresh() {
        document.getElementById('total').innerHTML = total();
        document.getElementById('deliv').innerHTML = priceChanger();
      }
      $( document ).ready(function() {
        document.getElementById('total').innerHTML = total();
        document.getElementById('deliv').innerHTML = priceChanger();
      });
  

 
  var payHandler = function () {

    
        var widget = new cp.CloudPayments();
        widget.charge({ // options
                publicId: 'pk_2cdd5b0bd7978802123946d757d4f',
                description: 'Оплата в teelab.ru',
                amount: total(), //сумма
                currency: 'RUB',
                invoiceId: '<%= @order_clientid %>', //номер заказа

            },
            function (options) { 
              $("#new_order").submit();
            },
            function (reason, options) { 
            });
  };



    $("#sb").on("click", function() {
        if ($("#new_order").valid()) {

            payHandler();
        }

    });

    

<% end %>
